<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мы любим Асаль</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, get, set, push, remove } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBTcH3_tri2L7AHLh1e-YD-0s-QSthuE6Q",
      authDomain: "disk-c98ee.firebaseapp.com",
      projectId: "disk-c98ee",
      storageBucket: "disk-c98ee.appspot.com",
      messagingSenderId: "59577059636",
      appId: "1:59577059636:web:e98f456d054cc360747d61",
      databaseURL: "https://disk-c98ee-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.firebaseStuff = { db, ref, get, set, push, remove };
  </script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #000;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    .hidden { display: none !important; }
    button {
      background: #ff4da6;
      border: none;
      color: white;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background: #ff007f; }
    input { padding: 10px; border-radius: 8px; margin: 10px; font-size: 16px; }
    .menu, .submenu, .auth, .admin { display: flex; flex-direction: column; align-items: center; }
    video, audio { max-width: 90vw; max-height: 70vh; margin-top: 20px; }
    #asalScreen {
      font-size: 3em;
      text-align: center;
      color: #ff4da6;
      text-shadow: 0 0 20px #ff007f;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { background-color: black; }
      50% { background-color: white; color: black; }
      100% { background-color: black; }
    }
    #version {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 14px;
      color: #888;
    }
    #adminBtn {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
<div id="version">v3</div>
<button id="adminBtn" onclick="enterAdmin()">Креатор</button>

<div id="auth" class="auth">
  <h2>Введите токен</h2>
  <input id="tokenInput" placeholder="Токен" onkeydown="if(event.key==='Enter')checkToken()"/>
  <button onclick="checkToken()">Войти</button>
</div>

<div id="adminPanel" class="admin hidden">
  <h3>Админка</h3>
  <input id="newToken" placeholder="Генерировать токен" />
  <button onclick="generateToken()">Создать</button>
  <div id="tokenList"></div>
  <button onclick="logoutAdmin()">Выйти</button>
</div>

<div id="categoryMenu" class="menu hidden">
  <button onclick="showSubMenu('songsMenu')">Песня</button>
  <button onclick="showSubMenu('videosMenu')">Кнопка НЕ нажимать</button>
  <button onclick="showAsal()">Мы любим Асаль</button>
  <button onclick="cancelAll()">Отмена</button>
</div>

<div id="songsMenu" class="submenu hidden">
  <button onclick="playAudio('round-start.mp3')">Амонг Ас</button>
  <button onclick="playAudio('tum-tum-tum-sahur.mp3')">Тум Тум Сахур</button>
  <button onclick="playAudio('audio_2025-08-01_23-01-57.mp3')">Это не забудем Тимура</button>
  <button onclick="goBackToCategories()">Назад</button>
</div>

<div id="videosMenu" class="submenu hidden">
  <button onclick="playVideo('oY9EGRFUCQDcF7MAKmJgfVEloRIiRIjFkerREB.mp4')">Тимур</button>
  <button onclick="playVideo('oMTvPfb7222222.mp4')">МГРР</button>
  <button onclick="goBackToCategories()">Назад</button>
</div>

<div id="asal" class="submenu hidden">
  <div id="asalScreen">МЫ ЛЮБИМ АСАЛЬ</div>
  <audio id="asalAudio" src="ppol.mp3" autoplay loop></audio>
  <button onclick="goBackToCategories()">Назад</button>
</div>

<video id="videoPlayer" class="hidden" controls></video>
<audio id="audioPlayer" class="hidden" controls></audio>

<script>
  const adminPass = "228";

  function hideAll() {
    document.querySelectorAll('.menu, .submenu, .auth, .admin').forEach(e => e.classList.add('hidden'));
    cancelAll();
  }

  function cancelAll() {
    const video = document.getElementById('videoPlayer');
    video.pause();
    video.classList.add('hidden');
    const audio = document.getElementById('audioPlayer');
    audio.pause();
    audio.classList.add('hidden');
    const asal = document.getElementById('asalAudio');
    asal.pause();
    asal.classList.add('hidden');
  }

  function playAudio(file) {
    cancelAll();
    const audio = document.getElementById('audioPlayer');
    audio.src = file;
    audio.classList.remove('hidden');
    audio.play();
  }

  function playVideo(file) {
    cancelAll();
    const video = document.getElementById('videoPlayer');
    video.src = file;
    video.classList.remove('hidden');
    video.play();
  }

  function showAsal() {
    hideAll();
    document.getElementById('asal').classList.remove('hidden');
    const asal = document.getElementById('asalAudio');
    asal.classList.remove('hidden');
    asal.play();
  }

  function showSubMenu(id) {
    hideAll();
    document.getElementById(id).classList.remove('hidden');
  }

  function goBackToCategories() {
    hideAll();
    document.getElementById('categoryMenu').classList.remove('hidden');
  }

  async function checkToken() {
    const token = document.getElementById('tokenInput').value.trim();
    const { db, ref, get, remove } = window.firebaseStuff;
    const tokenRef = ref(db, `tokens/${token}`);
    const snap = await get(tokenRef);
    if (snap.exists()) {
      await remove(tokenRef);
      hideAll();
      document.getElementById('categoryMenu').classList.remove('hidden');
    } else {
      alert('Неверный токен');
    }
  }

  async function generateToken() {
    const { db, ref, set } = window.firebaseStuff;
    const token = document.getElementById('newToken').value || Math.random().toString(36).slice(2, 10);
    await set(ref(db, `tokens/${token}`), true);
    alert(`Токен создан: ${token}`);
    loadTokens();
  }

  async function loadTokens() {
    const { db, ref, get } = window.firebaseStuff;
    const snap = await get(ref(db, 'tokens'));
    const list = document.getElementById('tokenList');
    list.innerHTML = '<h4>Активные токены:</h4>';
    if (snap.exists()) {
      Object.keys(snap.val()).forEach(t => {
        const d = document.createElement('div');
        d.textContent = t;
        list.appendChild(d);
      });
    }
  }

  function enterAdmin() {
    const pass = prompt('Пароль администратора:');
    if (pass === adminPass) {
      hideAll();
      document.getElementById('adminPanel').classList.remove('hidden');
      loadTokens();
    } else {
      alert('Неверный пароль');
    }
  }

  function logoutAdmin() {
    hideAll();
    document.getElementById('auth').classList.remove('hidden');
  }
</script>
</body>
</html>

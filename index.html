<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <title>Bebra 71</title>
    <style>
        :root {
            --blue: #4da8ff;
            --blue-dark: #003087;
            --font: 'Segoe UI', 'Roboto', sans-serif;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html, body {
            height: 100vh;
            width: 100vw;
            font-family: var(--font);
            background: radial-gradient(circle at 50% 50%, #001d3d, #003087);
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .stars, .stars2, .stars3 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
        }
        .stars {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="2" r="2" fill="white"/></svg>') repeat;
            background-size: 40px 40px;
            opacity: 0.9;
            filter: blur(1.5px);
            animation: twinkle 10s infinite ease-in-out;
        }
        .stars2 {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="white"/></svg>') repeat;
            background-size: 60px 60px;
            opacity: 0.7;
            filter: blur(1px);
            animation: twinkle 8s infinite ease-in-out;
        }
        .stars3 {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="4" fill="white"/></svg>') repeat;
            background-size: 80px 80px;
            opacity: 0.5;
            filter: blur(0.5px);
            animation: twinkle 6s infinite ease-in-out;
        }
        @keyframes twinkle {
            0% { opacity: 0.5; transform: scale(0.6); }
            50% { opacity: 1; transform: scale(1); }
            100% { opacity: 0.5; transform: scale(0.6); }
        }
        button {
            position: relative;
            overflow: hidden;
            background: var(--blue);
            border: none;
            color: white;
            padding: 10px 25px;
            margin: 10px;
            border-radius: 12px;
            font-size: clamp(14px, 4vw, 16px);
            cursor: pointer;
            width: 90vw;
            max-width: 300px;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        button:hover {
            background: var(--blue-dark);
            transform: scale(1.05);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        button::after {
            content: '';
            position: absolute;
            background: radial-gradient(circle, rgba(77, 168, 255, 0.5), transparent);
            width: 0;
            height: 0;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: width 0.6s ease, height 0.6s ease, opacity 0.6s ease;
        }
        button.ripple::after {
            width: 200px;
            height: 200px;
            opacity: 1;
        }
        .container {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            position: relative;
            z-index: 1;
            padding: 10px;
        }
        .container.visible {
            display: flex;
        }
        .container.visible button:nth-child(odd) {
            animation: slide-in-left 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .container.visible button:nth-child(even) {
            animation: slide-in-right 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .container.visible button:first-child,
        .container.visible #asalScreen,
        .container.visible #studentInfo {
            animation: drop-in 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .container.visible button:last-child {
            animation: pull-up 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .container.visible input {
            animation: drop-in 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .container:not(.visible) button,
        .container:not(.visible) input,
        .container:not(.visible) #asalScreen,
        .container:not(.visible) #studentInfo {
            animation: fade-out 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes slide-in-left {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-in-right {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes drop-in {
            0% { transform: translateY(-100vh); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes pull-up {
            0% { transform: translateY(100vh); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes fade-out {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(0); opacity: 0; }
        }
        @keyframes text-appear {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        body.transitioning {
            pointer-events: none;
        }
        #intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            color: var(--blue);
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2em, 8vw, 4em);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            animation: introfade 4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            text-shadow: 0 0 10px rgba(77, 168, 255, 0.5);
        }
        @keyframes introfade {
            0% { opacity: 0; transform: scale(0.5); text-shadow: 0 0 10px rgba(77, 168, 255, 0.5); }
            50% { opacity: 1; transform: scale(1.1); text-shadow: 0 0 20px rgba(77, 168, 255, 0.8); }
            100% { opacity: 0; transform: scale(1); visibility: hidden; text-shadow: 0 0 10px rgba(77, 168, 255, 0.5); }
        }
        input[type=password], input[type=text], input[type=number] {
            padding: 10px;
            border-radius: 8px;
            margin: 10px;
            font-size: clamp(14px, 4vw, 16px);
            border: 1px solid var(--blue);
            background: transparent;
            color: white;
            width: 80vw;
            max-width: 300px;
            -webkit-text-security: disc;
        }
        input[type=text], input[type=number] {
            -webkit-text-security: none;
        }
        #version {
            position: fixed;
            top: 10px;
            right: 20px;
            font-size: clamp(12px, 3vw, 13px);
            color: #aaa;
            z-index: 10000;
        }
        #consoleBtn {
            position: fixed;
            top: 10px;
            right: 20px;
            font-size: clamp(12px, 3vw, 13px);
            z-index: 10000;
            display: none;
        }
        @media (min-width: 768px) {
            #consoleBtn {
                display: block;
            }
            #intro {
                font-size: 4em;
            }
            #asalScreen, #studentInfo {
                font-size: clamp(1.2em, 3vw, 1.8em);
                line-height: 1.5;
            }
            #disclaimer {
                font-size: clamp(0.9em, 2vw, 1em);
            }
        }
        @media (max-width: 767px) {
            #intro {
                font-size: 2.5em;
            }
            #asalScreen, #studentInfo {
                font-size: clamp(0.9em, 3.5vw, 1.2em);
                line-height: 1.4;
                padding: 10px;
            }
            #disclaimer {
                font-size: clamp(0.7em, 2.5vw, 0.8em);
                padding: 5px;
            }
        }
        #asalScreen, #studentInfo {
            text-align: center;
            color: var(--blue);
            animation: neon 2s ease-in-out infinite alternate;
            letter-spacing: 1px;
            padding: 15px;
            margin-bottom: 15px;
            max-width: 90vw;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: clamp(0.9em, 3vw, 1.8em);
        }
        #studentInfo span {
            display: block;
            animation: text-appear 0.5s ease forwards;
            animation-delay: calc(0.1s * var(--i));
            margin: 5px 0;
        }
        #disclaimer {
            color: #ff3333;
            text-align: center;
            padding: 10px;
            max-width: 90vw;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: clamp(0.7em, 2.5vw, 1em);
        }
        @keyframes neon {
            0% { text-shadow: 0 0 5px rgba(77, 168, 255, 0.5); }
            100% { text-shadow: 0 0 10px rgba(77, 168, 255, 0.8); }
        }
        iframe {
            width: 95vw;
            height: 60vh;
            margin: 10px auto;
            border: none;
            display: block;
        }
        audio, video {
            width: 95vw;
            max-height: 40vh;
            margin: 10px auto;
            display: block;
        }
        audio.hidden, video.hidden, #minesweeperBoard.hidden {
            display: none;
        }
        button[data-student]::before {
            content: 'üîí ';
        }
        button[data-student].unlocked::before {
            content: '';
        }
        #studentPhoto {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid var(--blue);
        }
        #minesweeperMenu {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        #minesweeperMenu.visible {
            display: flex;
        }
        #balanceDisplay {
            font-size: clamp(1em, 3vw, 1.5em);
            color: var(--blue);
            margin-bottom: 10px;
            animation: neon 2s ease-in-out infinite alternate;
        }
        #betInputContainer {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        #betInput {
            width: 120px;
            text-align: center;
        }
        #startGameBtn {
            width: auto;
            padding: 10px 20px;
        }
        #minesweeperBoard {
            display: grid;
            grid-template-columns: repeat(9, 40px);
            gap: 2px;
            background: #001d3d;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid var(--blue-dark);
            transition: transform 0.2s, background 0.2s;
        }
        .cell:hover {
            transform: scale(1.1);
        }
        .cell.opened {
            background: #ffffff;
            color: #000000;
            transform: scale(0.95);
        }
        .cell.mine {
            background: #ff3333;
            animation: explode 0.5s ease-in-out;
        }
        .cell.flagged::before {
            content: 'üö©';
            animation: flag 0.3s ease-in;
        }
        @keyframes explode {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        @keyframes flag {
            0% { transform: rotate(-45deg); opacity: 0; }
            100% { transform: rotate(0); opacity: 1; }
        }
        @keyframes win {
            0% { background: #4da8ff; transform: scale(1); }
            50% { background: #00ff00; transform: scale(1.2); }
            100% { background: #4da8ff; transform: scale(1); }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffffff;
            opacity: 0.8;
            animation: fall 2s linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>
    <div id="intro">Said</div>
    <div id="version">v2.12</div>
    <button id="consoleBtn">–ö–æ–Ω—Å–æ–ª—å</button>

    <div class="container auth hidden">
        <input id="tokenInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω" autocomplete="off" />
        <button id="loginBtn">–í–æ–π—Ç–∏</button>
    </div>

    <div class="container menu hidden">
        <button data-menu="musicMenu">–ü–µ—Å–Ω—è</button>
        <button data-menu="videoMenu">–ö–Ω–æ–ø–∫–∞ –ù–ï –Ω–∞–∂–∏–º–∞—Ç—å</button>
        <button data-menu="asalMenu">üíñ –ú—ã –ª—é–±–∏–º –ê—Å–∞–ª—å</button>
        <button data-menu="gdzMenu">–ì–î–ó</button>
        <button data-menu="studentsMenu">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
        <button data-menu="minesweeperMenu">–°–∞–ø—ë—Ä</button>
        <button id="logoutBtn">–í—ã—Ö–æ–¥</button>
    </div>

    <div class="container submenu hidden" id="musicMenu">
        <audio id="audio" controls class="hidden"></audio>
        <button data-audio="round-start.mp3">–ê–º–æ–Ω–≥ –ê—Å</button>
        <button data-audio="tum-tum-tum-sahur.mp3">–¢—É–º –¢—É–º –°–∞—Ö—É—Ä</button>
        <button data-audio="audio_2025-08-01_23-01-57.mp3">–≠—Ç–æ –Ω–µ –∑–∞–±—É–¥–µ–º –¢–∏–º—É—Ä–∞</button>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div class="container submenu hidden" id="videoMenu">
        <video id="video" controls class="hidden" preload="metadata"></video>
        <button data-video="oY9EGRFUCQDcF7MAKmJgfVEloRIiRIjFkerREB.mp4">–¢–∏–º—É—Ä</button>
        <button data-video="oMTvPfb7222222.mp4">–ú–ì–†–†</button>
        <button data-video="ivanzolo.mp4">–ò–≤–∞–Ω–∑–æ–ª–æ</button>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div class="container submenu hidden" id="asalMenu">
        <audio id="asalAudio" autoplay class="hidden"></audio>
        <div id="asalScreen">üíñ –ú—ã –ª—é–±–∏–º –ê—Å–∞–ª—å üíñ</div>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div class="container submenu hidden" id="gdzMenu">
        <iframe src="" id="gdzFrame" allowfullscreen></iframe>
        <button data-gdzkey="english">–ì–î–ó –ê–Ω–≥–ª–∏–π—Å–∫–∏–π</button>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div class="container submenu hidden" id="studentsMenu">
        <div id="disclaimer">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</div>
        <input id="studentPassInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off" />
        <button id="studentPassBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>

    <div class="container submenu hidden" id="studentsListMenu">
        <input id="studentTokenInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞" autocomplete="off" />
        <button id="studentTokenBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <button data-student="timur" data-encrypted="13245533499" data-name="–¢–∏–º—É—Ä">üîí 13245533499</button>
        <button data-student="ibrohim" data-encrypted="39284232" data-name="–ò–±—Ä–æ—Ö–∏–º">üîí 39284232</button>
        <button data-student="amar" data-encrypted="5432109876" data-name="–ê–º–∞—Ä">üîí 5432109876</button>
        <button data-student="sabrina" data-encrypted="22214344" data-name="–°–∞–±—Ä–∏–Ω–∞">üîí 22214344</button>
        <button data-student="said" data-encrypted="12312333" data-name="–°–∞–∏–¥">üîí 12312333</button>
        <button data-student="said_samandarov" data-encrypted="31254355" data-name="–°–∞–∏–¥">üîí 31254355</button>
        <button data-student="abdumumin" data-encrypted="98765432" data-name="–ê–±–¥—É–º—É–º–∏–Ω">üîí 7777789</button>
        <button data-student="abubaker" data-encrypted="45678912" data-name="–ê–±—É–±–∞–∫–µ—Ä">üîí 45678912</button>
        <button data-student="Mohir" data-encrypted="45678912" data-name="–ú–æ—Ö–∏—Ä">üîí 7777112</button>
        <button data-student="Salta" data-encrypted="45678912" data-name="–°–∞–ª—Ç–∞–Ω–∞—Ç">üîí 773222</button>
        <button data-student="Zarina" data-encrypted="5455555" data-name="–ó–∞—Ä–∏–Ω–∞">üîí 7732122</button>
        <button data-student="Nasta" data-encrypted="5455555" data-name="–ù–∞—Å—Ç—è">üîí 77333222</button>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div class="container submenu hidden" id="studentInfoMenu">
        <img id="studentPhoto" src="" alt="–§–æ—Ç–æ —É—á–µ–Ω–∏–∫–∞" />
        <div id="studentInfo"></div>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
    </div>

    <div class="container submenu hidden" id="minesweeperMenu">
        <div id="balanceDisplay">–ë–∞–ª–∞–Ω—Å: 0 –º–æ–Ω–µ—Ç</div>
        <div id="betInputContainer">
            <input id="betInput" type="number" placeholder="–°—Ç–∞–≤–∫–∞ (–º–∏–Ω. 10)" min="10" />
            <button id="startGameBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        <div id="minesweeperBoard" class="hidden"></div>
        <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBTcH3_tri2L7AHLh1e-YD-0s-QSthuE6Q",
            authDomain: "disk-c98ee.firebaseapp.com",
            projectId: "disk-c98ee",
            storageBucket: "disk-c98ee.appspot.com",
            messagingSenderId: "59577059636",
            appId: "1:59577059636:web:e98f456d054cc360747d61",
            databaseURL: "https://disk-c98ee-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const tokenInput = document.getElementById('tokenInput');
        const loginBtn = document.getElementById('loginBtn');
        const auth = document.querySelector('.auth');
        const menu = document.querySelector('.menu');
        const audio = document.getElementById('audio');
        const video = document.getElementById('video');
        const asalAudio = document.getElementById('asalAudio');
        const gdzFrame = document.getElementById('gdzFrame');
        const musicMenu = document.getElementById('musicMenu');
        const videoMenu = document.getElementById('videoMenu');
        const asalMenu = document.getElementById('asalMenu');
        const gdzMenu = document.getElementById('gdzMenu');
        const studentsMenu = document.getElementById('studentsMenu');
        const studentsListMenu = document.getElementById('studentsListMenu');
        const studentInfoMenu = document.getElementById('studentInfoMenu');
        const studentPassInput = document.getElementById('studentPassInput');
        const studentPassBtn = document.getElementById('studentPassBtn');
        const studentTokenInput = document.getElementById('studentTokenInput');
        const studentTokenBtn = document.getElementById('studentTokenBtn');
        const studentInfo = document.getElementById('studentInfo');
        const studentPhoto = document.getElementById('studentPhoto');
        const backButtons = document.querySelectorAll('.back');
        const consoleBtn = document.getElementById('consoleBtn');
        const minesweeperMenu = document.getElementById('minesweeperMenu');
        const minesweeperBoard = document.getElementById('minesweeperBoard');
        const balanceDisplay = document.getElementById('balanceDisplay');
        const betInput = document.getElementById('betInput');
        const startGameBtn = document.getElementById('startGameBtn');

        const studentsData = {
            timur: {
                name: '–¢–∏–º—É—Ä',
                surname: '–ù—É—Ä–∞–ª–∏–µ–≤',
                patronymic: '–ú—É–∑–∞—Ñ—Ñ–∞—Ä–æ–≤–∏—á',
                birthDate: '28.08.2011',
                father: '–ú—É–∑–∑–∞—Ñ–∞—Ä –ù—É—Ä–∞–ª–∏–µ–≤',
                mother: '–ú–∞—Ñ—Ç—É–Ω–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, –ù—É—Ä–∞–ª–∏–µ–≤–∞)',
                class: '8–î Vosiq',
                phone: '+998946372464',
                motherPhone: '+998900060030',
                fatherPhone: '+998988122711',
                siblings: '–°–µ—Å—Ç—Ä–∞: –ê—Å–∞–ª—å –ù—É—Ä–∞–ª–∏–µ–≤–∞, 12 –ª–µ—Ç, 6–ö Vosiq',
                seria: 'FA9854006',
                photo: 'photo_2025-08-02_19-28-21.jpg'
            },
            ibrohim: {
                name: '–ò–±—Ä–æ—Ö–∏–º–∂–æ–Ω',
                surname: '–®–∞—Ä–∏–ø–æ–≤',
                patronymic: '–ë–∞–±—É—Ä –æ–≥–ª–∏',
                birthDate: '31.08.2011',
                father: '–ê—Ö–º–µ–¥–æ–≤ –ë–∞–±–∏—Ä –®–∞—Ä–∏–ø–æ–≤–∏—á',
                mother: '–ê—Ö–º–µ–¥–æ–≤–∞ –†—É—Ö—Å–æ—Ä–∞ –¢—É–π–º—É—Ä–æ–¥–æ–≤–∞',
                class: '8–î',
                phone: '+998917841115',
                motherPhone: '–ù–µ—Ç',
                fatherPhone: '–ù–µ—Ç',
                siblings: '–°–µ—Å—Ç—Ä–∞, –Ω–µ —Ä–æ–¥–Ω–∞—è',
                seria: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                photo: 'photo_2025-08-02_19-59-32.jpg'
            },
            amar: {
                name: '–ê–º–∞—Ä',
                surname: '–†—É—Å—Ç–∞–º–æ–≤',
                patronymic: '–ê–±–¥—É–ª–ª–∞–µ–≤–∏—á',
                birthDate: '22.02.2011',
                father: '–ê–±–¥—É–ª–ª–æ—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, –†—É—Å—Ç–∞–º–æ–≤)',
                mother: '–ë–∞—Ä–Ω–æ (—Ñ–∞–º–∏–ª–∏—è –∏ –æ—Ç—á–µ—Å—Ç–≤–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã)',
                class: '8–î Vosiq',
                phone: '+998901779599',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '+998919199999',
                seria: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                siblings: '–ë—Ä–∞—Ç: –°—É–ª–µ–π–º–∞–Ω –†—É—Å—Ç–∞–º–æ–≤, –ê–±–¥—É–ª–ª–∞–µ–≤–∏—á, 22.09.2013, Vosiq, +998970063007; –ë—Ä–∞—Ç: –ú—É—Ö–∞–º–º–∞–¥ –†—É—Å—Ç–∞–º–æ–≤, –ê–±–¥—É–ª–ª–∞–µ–≤–∏—á, 8-10 –ª–µ—Ç, Vosiq, –Ω–æ–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç; –ë—Ä–∞—Ç: –ê–±—É–±–∞–∫—Ä –†—É—Å—Ç–∞–º–æ–≤, 3-5 –ª–µ—Ç, —Å–∞–¥–∏–∫ Vosiq, –Ω–æ–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
                photo: 'photo_2025-08-02_21-29-13.jpg'
            },
            sabrina: {
                name: '–°–∞–±—Ä–∏–Ω–∞',
                surname: '–ö–æ–ø–ø–æ–ª–∞',
                patronymic: '–ö–∞—Ä–ª–æ–≤–Ω–∞',
                birthDate: '30.01.2012',
                father: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                mother: '–ê–ª—å–±–∏–Ω–∞ –ê,',
                class: '8–î Vosiq',
                phone: '+998908112259',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '–ë—Ä–∞—Ç: –ê–ª—å–±–µ—Ä—Ç–æ –ö–æ–ø–ø–æ–ª–∞, 2013, +998900027748; –°–µ—Å—Ç—Ä–∞: –ê–ª–∏–Ω–∞ –ö–æ–ø–ø–æ–ª–∞, 6-9 –ª–µ—Ç',
                seria: 'FA1439551',
                photo: 'photo_2025-08-02_22-04-26.jpg'
            },
            said: {
                name: '–°–∞–∏–¥',
                surname: '–£–º–∞—Ä–æ–≤',
                patronymic: '–£–ª—É–≥–±–µ–∫ –æ–≥–ª–∏',
                birthDate: '07.05.2011',
                father: '–£–ª—É–≥–±–µ–∫ –£–º–∞—Ä–æ–≤',
                mother: '–Æ–ª–¥—É–∑ –£–º–∞—Ä–æ–≤–∞',
                class: '8–î',
                phone: '+998947518833',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '1 —Å–µ—Å—Ç—Ä–∞ 1 –±—Ä–∞—Ç',
                seria: 'FA9557657',
                photo: 'photo_2025-03-04_13-47-17.jpg'
            },
            said_samandarov: {
                name: '–°–∞–∏–¥',
                surname: '–°–∞–º–∞–Ω–¥–∞—Ä–æ–≤',
                patronymic: '–•—É—Ä—à–∏–¥–æ–≤–∏—á',
                birthDate: '30.08.2011',
                father: '–ê–ª–∏—à–µ—Ä –í–æ—Å–∏–∫–æ–≤–∏—á',
                mother: '–®–æ–∏—Ä–∞',
                class: '8–î',
                phone: '+998770748507',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '–°–µ—Å—Ç—Ä–∞: –ö–∏–º—å—è –°–∞–º–∞–Ω–¥–∞—Ä–æ–≤–∞ –ê–ª–∏—à–µ—Ä–æ–≤–Ω–∞, –ø—Ä–∏–º–µ—Ä–Ω–æ 12 –ª–µ—Ç',
                photo: 'photo_2025-04-08_16-33-21.jpg'
            },
            abdumumin: {
                name: '–ê–±–¥—É–º—É–º–∏–Ω',
                surname: '–ê–±–¥—É–≤–∞—Ö–∏–¥–æ–≤',
                patronymic: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                birthDate: '22.02.2011',
                father: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                mother: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                class: '–î',
                phone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                photo: '2323.png'
            },
            abubaker: {
                name: '–ê–±—É–±–∞–∫–µ—Ä',
                surname: '–•–∞–∫–∏–º–æ–≤',
                patronymic: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                birthDate: '02.09.2011',
                father: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                mother: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                class: '8–î',
                phone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                photo: '23333.jpg'
            },
            Mohir: {
                name: '–ú–æ—Ö–∏—Ä',
                surname: '–ú–∏—Ä—Å–∞–º–∞–¥–æ–≤',
                patronymic: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                birthDate: '08.08.2011',
                father: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                mother: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                class: '8–î',
                phone: '+998909495522',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '2 —Å–µ—Å—Ç—Ä—ã',
                photo: '1111.jpg'
            },
            Salta: {
                name: '–°–∞–ª—Ç–∞–Ω–∞—Ç',
                surname: '–ú—É—Ç–∞–ª–æ–≤–∞',
                patronymic: '–£–ª—É–≥–±–µ–∫ –∫–∏–∑–∏',
                birthDate: '06.08.2011',
                father: '–£–ª—É–≥–±–µ–∫ –ú—É—Ç–∞–ª–æ–≤',
                mother: '–®–æ–∏—Ä–∞ –ú—É—Ç–∞–ª–æ–≤–∞',
                class: '8–î',
                phone: '+998974903134',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '2 —Å–µ—Å—Ç—Ä–∞',
                photo: '11112.jpg'
            },
            Zarina: {
                name: '–ó–∞—Ä–∏–Ω–∞',
                surname: '–ê–±–¥—É—Ä–∞—Ö–º–∞–Ω–æ–≤–∞',
                patronymic: '–ó–∞—Ä–∏—Ñ–¥–∂–æ–Ω–æ–≤–∞',
                birthDate: '19.04.2011',
                father: '–ó–∞—Ä–∏—Ñ',
                mother: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                class: '8–î',
                phone: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                fatherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                siblings: '1 —Å–µ—Å—Ç—Ä–∞',
                seria: 'FA5374603',
                photo: 'zzz.jpg'
            },
            Nasta: {
                name: '–ù–∞—Å—Ç—è',
                surname: '–•–∞—Ö–ª–∏–Ω–∞',
                patronymic: '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞',
                birthDate: '09.01.2011',
                father: '–î–º–∏—Ç—Ä–∏–π –•–∞—Ö–ª–∏–Ω –§–µ–¥–µ—Ä–æ–≤–∏—á',
                mother: '–•–∞—Ö–ª–∏–Ω–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞',
                class: '8–î',
                phone: '+998935704077',
                motherPhone: '+998909574081',
                fatherPhone: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                siblings: '1 —Å–µ—Å—Ç—Ä–∞',
                seria: '–¥–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã',
                photo: 'nasta.jpg'
            }
        };

        let isTokenVerified = false;
        let balance = 0;
        let currentToken = '';

        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth) * 100;
            const y = (e.clientY / window.innerHeight) * 100;
            document.body.style.background = `radial-gradient(circle at ${x}% ${y}%, #001d3d, #003087)`;
        });

        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('touchstart', (e) => {
                const rect = button.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                button.style.setProperty('--ripple-x', `${x}px`);
                button.style.setProperty('--ripple-y', `${y}px`);
                button.classList.add('ripple');
                setTimeout(() => button.classList.remove('ripple'), 600);
            });
        });

        function showElement(el) {
            if (!el) return;
            el.classList.remove('hidden');
            el.classList.add('visible');
            document.body.classList.add('transitioning');
            setTimeout(() => document.body.classList.remove('transitioning'), 1000);
        }

        function hideElement(el) {
            if (!el) return;
            el.classList.remove('visible');
            el.classList.add('hidden');
        }

        function hideElements(elements) {
            elements.forEach(el => hideElement(el));
        }

        function openMenu(menuId) {
            hideElements([menu, auth, musicMenu, videoMenu, asalMenu, gdzMenu, studentsMenu, studentsListMenu, studentInfoMenu, minesweeperMenu]);
            audio.pause();
            audio.classList.add('hidden');
            audio.src = '';
            video.pause();
            video.classList.add('hidden');
            video.src = '';
            asalAudio.pause();
            asalAudio.classList.add('hidden');
            asalAudio.src = '';
            studentInfo.textContent = '';
            studentPhoto.src = '';
            studentTokenInput.value = '';
            isTokenVerified = false;
            studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
                btn.textContent = `üîí ${btn.getAttribute('data-encrypted')}`;
                btn.classList.remove('unlocked');
            });
            const el = document.getElementById(menuId);
            if (el) {
                showElement(el);
                if (menuId === 'asalMenu') {
                    asalAudio.src = 'ppol.mp3';
                    asalAudio.classList.remove('hidden');
                    asalAudio.play().catch(err => {
                        alert('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ppol.mp3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞.');
                    });
                } else if (menuId === 'minesweeperMenu') {
                    minesweeperBoard.classList.add('hidden');
                    betInput.value = '';
                    balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balance} –º–æ–Ω–µ—Ç`;
                }
            }
        }

        async function checkToken(token) {
            try {
                const snapshot = await get(ref(db, 'tokens/' + token));
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    balance = userData.balance || 0;
                    currentToken = token;
                    balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balance} –º–æ–Ω–µ—Ç`;
                    return true;
                }
                return false;
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞: ' + error.message);
                return false;
            }
        }

        async function updateBalance(token, newBalance) {
            try {
                await set(ref(db, 'tokens/' + token + '/balance'), newBalance);
                balance = newBalance;
                balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balance} –º–æ–Ω–µ—Ç`;
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: ' + error.message);
            }
        }

        async function checkStudentToken(token) {
            try {
                const snapshot = await get(ref(db, 'studentTokens/' + token));
                return snapshot.exists();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + error.message);
                return false;
            }
        }

        loginBtn.addEventListener('click', async () => {
            const token = tokenInput.value.trim();
            if (!token) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
            loginBtn.disabled = true;
            const valid = await checkToken(token);
            loginBtn.disabled = false;
            if (valid) {
                hideElement(auth);
                showElement(menu);
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            hideElement(menu);
            hideElements(document.querySelectorAll('.submenu'));
            tokenInput.value = '';
            balance = 0;
            currentToken = '';
            balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: 0 –º–æ–Ω–µ—Ç`;
            showElement(auth);
        });

        menu.querySelectorAll('button[data-menu]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                hideElement(menu);
                const menuId = btn.getAttribute('data-menu');
                openMenu(menuId);
            });
        });

        backButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (studentInfoMenu.classList.contains('visible')) {
                    hideElement(studentInfoMenu);
                    showElement(studentsListMenu);
                } else if (studentsListMenu.classList.contains('visible')) {
                    hideElement(studentsListMenu);
                    showElement(studentsMenu);
                } else {
                    hideElements(document.querySelectorAll('.submenu'));
                    showElement(menu);
                }
            });
        });

        musicMenu.querySelectorAll('button[data-audio]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const audioFile = btn.getAttribute('data-audio');
                video.pause();
                video.classList.add('hidden');
                asalAudio.pause();
                asalAudio.classList.add('hidden');
                audio.src = audioFile;
                audio.classList.remove('hidden');
                audio.play().catch(err => {
                    alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ${audioFile}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞.`);
                });
            });
        });

        videoMenu.querySelectorAll('button[data-video]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const videoFile = btn.getAttribute('data-video');
                audio.pause();
                audio.classList.add('hidden');
                asalAudio.pause();
                asalAudio.classList.add('hidden');
                video.src = videoFile;
                video.classList.remove('hidden');
                video.load();
                video.play().catch(err => {
                    alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ${videoFile}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –µ–≥–æ —Ñ–æ—Ä–º–∞—Ç.`);
                });
            });
        });

        const gdzUrls = {
            'english': 'https://gdz.ru/class-7/english/spotlight-7/'
        };

        gdzMenu.querySelectorAll('button[data-gdzkey]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const key = btn.getAttribute('data-gdzkey');
                if (gdzUrls[key]) {
                    gdzFrame.src = gdzUrls[key];
                }
            });
        });

        studentPassBtn.addEventListener('click', () => {
            const pass = studentPassInput.value.trim();
            if (pass === 'V228') {
                hideElement(studentsMenu);
                showElement(studentsListMenu);
                studentPassInput.value = '';
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        });

        studentTokenBtn.addEventListener('click', async () => {
            const token = studentTokenInput.value.trim();
            if (!token) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
            const valid = await checkStudentToken(token);
            if (valid) {
                isTokenVerified = true;
                studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
                    btn.textContent = btn.getAttribute('data-name');
                    btn.classList.add('unlocked');
                });
                studentTokenInput.value = '';
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
            }
        });

        studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isTokenVerified) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
                    return;
                }
                const studentId = btn.getAttribute('data-student');
                const data = studentsData[studentId];
                if (data) {
                    studentInfo.innerHTML = `
                        <span style="--i:1">–ò–º—è: ${data.name}</span>
                        <span style="--i:2">–§–∞–º–∏–ª–∏—è: ${data.surname}</span>
                        <span style="--i:3">–û—Ç—á–µ—Å—Ç–≤–æ: ${data.patronymic}</span>
                        <span style="--i:4">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: ${data.birthDate}</span>
                        <span style="--i:5">–û—Ç–µ—Ü: ${data.father}</span>
                        <span style="--i:6">–ú–∞—Ç—å: ${data.mother}</span>
                        <span style="--i:7">–ö–ª–∞—Å—Å: ${data.class}</span>
                        <span style="--i:8">–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}</span>
                        <span style="--i:9">–¢–µ–ª–µ—Ñ–æ–Ω –º–∞—Ç–µ—Ä–∏: ${data.motherPhone}</span>
                        <span style="--i:10">–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç—Ü–∞: ${data.fatherPhone}</span>
                        <span style="--i:11">–ë—Ä–∞—Ç—å—è/—Å—ë—Å—Ç—Ä—ã: ${data.siblings}</span>
                        <span style="--i:12">–°–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä: ${data.seria}</span>
                    `;
                    studentPhoto.src = data.photo;
                    studentPhoto.onerror = () => {
                        alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ ${data.photo}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞.`);
                        studentPhoto.src = '';
                    };
                    hideElement(studentsListMenu);
                    showElement(studentInfoMenu);
                }
            });
        });

        // Minesweeper Game Logic
        const SIZE = 9;
        const MINES = 10;
        let board = [];
        let gameOver = false;
        let bet = 0;

        function initializeBoard() {
            board = [];
            for (let i = 0; i < SIZE; i++) {
                let row = [];
                for (let j = 0; j < SIZE; j++) {
                    row.push({
                        isMine: false,
                        isOpened: false,
                        isFlagged: false,
                        adjacentMines: 0
                    });
                }
                board.push(row);
            }
            let minesPlaced = 0;
            while (minesPlaced < MINES) {
                const row = Math.floor(Math.random() * SIZE);
                const col = Math.floor(Math.random() * SIZE);
                if (!board[row][col].isMine) {
                    board[row][col].isMine = true;
                    minesPlaced++;
                }
            }
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    if (!board[i][j].isMine) {
                        board[i][j].adjacentMines = countAdjacentMines(i, j);
                    }
                }
            }
        }

        function countAdjacentMines(row, col) {
            let count = 0;
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    const newRow = row + dr;
                    const newCol = col + dc;
                    if (newRow >= 0 && newRow < SIZE && newCol >= 0 && newCol < SIZE) {
                        if (board[newRow][newCol].isMine) count++;
                    }
                }
            }
            return count;
        }

        function renderBoard() {
            minesweeperBoard.innerHTML = '';
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    if (board[i][j].isOpened) {
                        cell.classList.add('opened');
                        if (board[i][j].isMine) {
                            cell.classList.add('mine');
                            cell.textContent = 'üí£';
                        } else if (board[i][j].adjacentMines > 0) {
                            cell.textContent = board[i][j].adjacentMines;
                        }
                    } else if (board[i][j].isFlagged) {
                        cell.classList.add('flagged');
                    }
                    cell.addEventListener('click', () => openCell(i, j));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        flagCell(i, j);
                    });
                    minesweeperBoard.appendChild(cell);
                }
            }
        }

        function openCell(row, col) {
            if (gameOver || board[row][col].isOpened || board[row][col].isFlagged) return;
            board[row][col].isOpened = true;
            if (board[row][col].isMine) {
                gameOver = true;
                updateBalance(currentToken, balance - bet);
                alert(`–ë–∞–±–∞—Ö! –¢—ã –ø–æ–ø–∞–ª –Ω–∞ –º–∏–Ω—É. -${bet} –º–æ–Ω–µ—Ç.`);
                renderBoard();
                return;
            }
            if (board[row][col].adjacentMines === 0) {
                floodFill(row, col);
            }
            if (checkWin()) {
                gameOver = true;
                const reward = bet + Math.floor(getOpenedCells() / 5) * 10;
                updateBalance(currentToken, balance + reward);
                alert(`–ö—Ä–∞—Å–∞–≤—á–∏–∫! –ü–æ–±–µ–¥–∞! +${reward} –º–æ–Ω–µ—Ç.`);
                showConfetti();
                renderBoard();
            }
            renderBoard();
        }

        function flagCell(row, col) {
            if (gameOver || board[row][col].isOpened) return;
            board[row][col].isFlagged = !board[row][col].isFlagged;
            renderBoard();
        }

        function floodFill(row, col) {
            if (row < 0 || row >= SIZE || col < 0 || col < SIZE || board[row][col].isOpened || board[row][col].isFlagged) return;
            board[row][col].isOpened = true;
            if (board[row][col].adjacentMines === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr === 0 && dc === 0) continue;
                        floodFill(row + dr, col + dc);
                    }
                }
            }
        }

        function checkWin() {
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    if (!board[i][j].isMine && !board[i][j].isOpened) return false;
                }
            }
            return true;
        }

        function getOpenedCells() {
            let count = 0;
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    if (board[i][j].isOpened) count++;
                }
            }
            return count;
        }

        function showConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = ['#ff3333', '#4da8ff', '#00ff00'][Math.floor(Math.random() * 3)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        function startMinesweeper() {
            bet = parseInt(betInput.value) || 10;
            if (bet < 10) {
                alert('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–æ–Ω–µ—Ç!');
                return;
            }
            if (bet > balance) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
                return;
            }
            gameOver = false;
            initializeBoard();
            minesweeperBoard.classList.remove('hidden');
            renderBoard();
        }

        startGameBtn.addEventListener('click', startMinesweeper);

        consoleBtn.addEventListener('click', async () => {
            const consoleToken = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏');
            if (consoleToken !== 'V') {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                return;
            }
            const panel = document.createElement('div');
            panel.style = `
                position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
                background: #001d3d; color: white; padding: 20px; border-radius: 10px;
                z-index: 100000; max-width: 400px; width: 90vw;
                max-height: 70vh; overflow-y: auto;
                font-size: clamp(0.9em, 2.5vw, 1em);
            `;
            panel.innerHTML = `
                <h2>–ö–æ–Ω—Å–æ–ª—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏</h2>
                <input id="newTokenInput" placeholder="–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω" style="width: 80%; padding: 8px; margin-bottom: 10px; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
                <button id="addTokenBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
                <input id="newStudentTokenInput" placeholder="–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞" style="width: 80%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
                <button id="addStudentTokenBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞</button>
                <input id="setBalanceInput" placeholder="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å" style="width: 80%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
                <button id="setBalanceBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                <button id="closeConsoleBtn" style="margin-left: 10px; background: var(--blue-dark);">–ó–∞–∫—Ä—ã—Ç—å</button>
                <div id="tokensList" style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤...</div>
                <div id="studentTokensList" style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞...</div>
            `;
            document.body.appendChild(panel);

            const newTokenInput = panel.querySelector('#newTokenInput');
            const addTokenBtn = panel.querySelector('#addTokenBtn');
            const newStudentTokenInput = panel.querySelector('#newStudentTokenInput');
            const addStudentTokenBtn = panel.querySelector('#addStudentTokenBtn');
            const setBalanceInput = panel.querySelector('#setBalanceInput');
            const setBalanceBtn = panel.querySelector('#setBalanceBtn');
            const closeConsoleBtn = panel.querySelector('#closeConsoleBtn');
            const tokensList = panel.querySelector('#tokensList');
            const studentTokensList = panel.querySelector('#studentTokensList');

            async function updateTokensList() {
                try {
                    tokensList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤...';
                    const snapshot = await get(ref(db, 'tokens'));
                    if (snapshot.exists()) {
                        const tokens = snapshot.val();
                        tokensList.innerHTML = '';
                        if (Object.keys(tokens).length === 0) {
                            tokensList.textContent = '–¢–æ–∫–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                        } else {
                            Object.keys(tokens).forEach(t => {
                                const tokenEl = document.createElement('div');
                                tokenEl.style = 'display:flex; justify-content:space-between; margin-bottom:6px; border-bottom: 1px solid #444; padding-bottom:4px;';
                                tokenEl.textContent = t;
                                const delBtn = document.createElement('button');
                                delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                                delBtn.style.background = '#a00';
                                delBtn.style.color = 'white';
                                delBtn.style.border = 'none';
                                delBtn.style.borderRadius = '6px';
                                delBtn.style.cursor = 'pointer';
                                delBtn.addEventListener('click', async () => {
                                    try {
                                        await remove(ref(db, 'tokens/' + t));
                                        updateTokensList();
                                    } catch (error) {
                                        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ' + error.message);
                                    }
                                });
                                tokenEl.appendChild(delBtn);
                                tokensList.appendChild(tokenEl);
                            });
                        }
                    } else {
                        tokensList.textContent = '–¢–æ–∫–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                    }
                } catch (error) {
                    tokensList.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤: ' + error.message;
                }
            }

            async function updateStudentTokensList() {
                try {
                    studentTokensList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞...';
                    const snapshot = await get(ref(db, 'studentTokens'));
                    if (snapshot.exists()) {
                        const tokens = snapshot.val();
                        studentTokensList.innerHTML = '';
                        if (Object.keys(tokens).length === 0) {
                            studentTokensList.textContent = '–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                        } else {
                            Object.keys(tokens).forEach(t => {
                                const tokenEl = document.createElement('div');
                                tokenEl.style = 'display:flex; justify-content:space-between; margin-bottom:6px; border-bottom: 1px solid #444; padding-bottom:4px;';
                                tokenEl.textContent = t;
                                const delBtn = document.createElement('button');
                                delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                                delBtn.style.background = '#a00';
                                delBtn.style.color = 'white';
                                delBtn.style.border = 'none';
                                delBtn.style.borderRadius = '6px';
                                delBtn.style.cursor = 'pointer';
                                delBtn.addEventListener('click', async () => {
                                    try {
                                        await remove(ref(db, 'studentTokens/' + t));
                                        updateStudentTokensList();
                                    } catch (error) {
                                        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + error.message);
                                    }
                                });
                                tokenEl.appendChild(delBtn);
                                studentTokensList.appendChild(tokenEl);
                            });
                        }
                    } else {
                        studentTokensList.textContent = '–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                    }
                } catch (error) {
                    studentTokensList.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞: ' + error.message;
                }
            }

            addTokenBtn.addEventListener('click', async () => {
                const newToken = newTokenInput.value.trim();
                if (!newToken) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                try {
                    await set(ref(db, 'tokens/' + newToken), { balance: 0 });
                    newTokenInput.value = '';
                    updateTokensList();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ' + error.message);
                }
            });

            addStudentTokenBtn.addEventListener('click', async () => {
                const newStudentToken = newStudentTokenInput.value.trim();
                if (!newStudentToken) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                try {
                    await set(ref(db, 'studentTokens/' + newStudentToken), true);
                    newStudentTokenInput.value = '';
                    updateStudentTokensList();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + error.message);
                }
            });

            setBalanceBtn.addEventListener('click', async () => {
                const newBalance = parseInt(setBalanceInput.value.trim());
                if (isNaN(newBalance)) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç');
                const token = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞');
                if (!token) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
                try {
                    await set(ref(db, 'tokens/' + token + '/balance'), newBalance);
                    setBalanceInput.value = '';
                    updateTokensList();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.message);
                }
            });

            closeConsoleBtn.addEventListener('click', () => {
                panel.remove();
            });

            updateTokensList();
            updateStudentTokensList();
        });

        window.addEventListener('load', () => {
            setTimeout(() => {
                const intro = document.getElementById('intro');
                intro.style.display = 'none';
                showElement(auth);
            }, 4000);
        });
    </script>
</body>
</html>


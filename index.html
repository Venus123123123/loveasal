<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Said - –ü–∞–Ω–µ–ª—å</title>
<style>
    :root {
        --blue: #4da8ff;
        --blue-dark: #003087;
    }
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #001d3d;
        color: white;
        overflow-x: hidden;
        transition: background 0.5s ease;
    }
    .hidden { display: none !important; }
    .visible { display: block !important; }
    button {
        padding: 10px;
        border-radius: 8px;
        margin: 10px 5px;
        font-size: clamp(14px, 4vw, 16px);
        border: 1px solid var(--blue);
        background: transparent;
        color: white;
        width: auto;
        max-width: 300px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        user-select: none;
    }
    button.ripple::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        width: 100px;
        height: 100px;
        background: rgba(77, 168, 255, 0.3);
        top: var(--ripple-y);
        left: var(--ripple-x);
        pointer-events: none;
        animation: rippleEffect 0.6s linear;
        transform: translate(-50%, -50%);
        z-index: 0;
    }
    @keyframes rippleEffect {
        from { transform: translate(-50%, -50%) scale(0); opacity: 1; }
        to { transform: translate(-50%, -50%) scale(4); opacity: 0; }
    }
    input[type=password], input[type=text] {
        padding: 10px;
        border-radius: 8px;
        margin: 10px;
        font-size: clamp(14px, 4vw, 16px);
        border: 1px solid var(--blue);
        background: transparent;
        color: white;
        width: 80vw;
        max-width: 300px;
        -webkit-text-security: disc;
    }
    input[type=text] {
        -webkit-text-security: none;
    }
    #version {
        position: fixed;
        top: 10px;
        right: 20px;
        font-size: clamp(12px, 3vw, 13px);
        color: #aaa;
        z-index: 10000;
    }
    #consoleBtn {
        position: fixed;
        top: 10px;
        left: 20px;
        font-size: clamp(12px, 3vw, 13px);
        z-index: 10000;
        display: none;
    }
    @media (min-width: 768px) {
        #consoleBtn { display: block; }
        #intro { font-size: 4em; }
        #asalScreen, #studentInfo {
            font-size: clamp(1.2em, 3vw, 1.8em);
            line-height: 1.5;
        }
        #disclaimer {
            font-size: clamp(0.9em, 2vw, 1em);
        }
    }
    @media (max-width: 767px) {
        #intro { font-size: 2.5em; }
        #asalScreen, #studentInfo {
            font-size: clamp(0.9em, 3.5vw, 1.2em);
            line-height: 1;
        }
        #disclaimer {
            font-size: clamp(0.7em, 2.5vw, 0.8em);
            padding: 5px;
        }
    }
    #asalScreen, #studentInfo {
        text-align: center;
        color: var(--blue);
        animation: neon 2s ease-in-out infinite alternate;
        letter-spacing: 1px;
        padding: 15px;
        margin-bottom: 15px;
        max-width: 90vw;
        word-wrap: break-word;
        overflow-wrap: break-word;
        font-size: clamp(0.9em, 3vw, 1.8em);
    }
    #studentInfo span {
        display: block;
        animation: text-appear 0.5s ease forwards;
        animation-delay: calc(0.1s * var(--i));
        margin: 5px 0;
    }
    #disclaimer {
        color: #ff3333;
        text-align: center;
        padding: 10px;
        max-width: 90vw;
        word-wrap: break-word;
        overflow-wrap: break-word;
        font-size: clamp(0.7em, 2.5vw, 1em);
    }
    @keyframes neon {
        0% { text-shadow: 0 0 5px rgba(77, 168, 255, 0.5); }
        100% { text-shadow: 0 0 10px rgba(77, 168, 255, 0.8); }
    }
    @keyframes text-appear {
        from {opacity: 0; transform: translateY(10px);}
        to {opacity: 1; transform: translateY(0);}
    }
    iframe {
        width: 95vw;
        height: 60vh;
        margin: 10px auto;
        border: none;
        display: block;
    }
    audio, video {
        width: 95vw;
        max-height: 40vh;
        margin: 10px auto;
        display: block;
    }
    audio.hidden, video.hidden {
        display: none;
    }
    button[data-student]::before {
        content: 'üîí ';
    }
    button[data-student].unlocked::before {
        content: '';
    }
    #studentPhoto {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 10px;
        border: 2px solid var(--blue);
    }
    /* –°–∞–ø–µ—Ä */
    #minesweeperBtn {
        margin: 20px auto;
        display: block;
        background: var(--blue);
        border: none;
        color: white;
        font-weight: bold;
    }
    #balanceDisplay {
        margin: 10px auto;
        color: #4da8ff;
        text-align: center;
        font-size: 1.2em;
    }
    #gameContainer {
        max-width: 320px;
        margin: 20px auto;
        display: none;
        user-select: none;
    }
    #minefield {
        display: grid;
        grid-template-columns: repeat(9, 30px);
        grid-template-rows: repeat(9, 30px);
        gap: 2px;
    }
    .cell {
        width: 30px;
        height: 30px;
        background: #003087;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
    }
    .cell.revealed {
        background: #4da8ff;
        cursor: default;
    }
    .cell.mine {
        background: #a00;
    }
</style>
</head>
<body>
<div class="stars"></div>
<div class="stars2"></div>
<div class="stars3"></div>

<div id="intro">Said</div>
<div id="version">v2.12</div>
<button id="consoleBtn">–ö–æ–Ω—Å–æ–ª—å</button>

<div class="container auth hidden">
    <input id="tokenInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω" autocomplete="off" />
    <button id="loginBtn">–í–æ–π—Ç–∏</button>
</div>

<div class="container menu hidden">
    <button data-menu="musicMenu">–ü–µ—Å–Ω—è</button>
    <button data-menu="videoMenu">–ö–Ω–æ–ø–∫–∞ –ù–ï –Ω–∞–∂–∏–º–∞—Ç—å</button>
    <button data-menu="asalMenu">üíñ –ú—ã –ª—é–±–∏–º –ê—Å–∞–ª—å</button>
    <button data-menu="gdzMenu">–ì–î–ó</button>
    <button data-menu="studentsMenu">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
    <button id="minesweeperBtn">–ü–µ—Ä–µ–π—Ç–∏ –≤ –°–∞–ø—ë—Ä</button>
    <button id="logoutBtn">–í—ã—Ö–æ–¥</button>
    <div id="balanceDisplay">–ë–∞–ª–∞–Ω—Å: 0 –º–æ–Ω–µ—Ç</div>
</div>

<div class="container submenu hidden" id="musicMenu">
    <audio id="audio" controls class="hidden"></audio>
    <button data-audio="round-start.mp3">–ê–º–æ–Ω–≥ –ê—Å</button>
    <button data-audio="tum-tum-tum-sahur.mp3">–¢—É–º –¢—É–º –°–∞—Ö—É—Ä</button>
    <button data-audio="audio_2025-08-01_23-01-57.mp3">–≠—Ç–æ –Ω–µ –∑–∞–±—É–¥–µ–º –¢–∏–º—É—Ä–∞</button>
    <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
</div>

<div class="container submenu hidden" id="videoMenu">
    <video id="video" controls class="hidden" preload="metadata"></video>
    <button data-video="oY9EGRFUCQDcF7MAKmJgfVEloRIiRIjFkerREB.mp4">–¢–∏–º—É—Ä</button>
    <button data-video="oMTvPfb7222222.mp4">–ú–ì–†–†</button>
    <button data-video="ivanzolo.mp4">–ò–≤–∞–Ω–∑–æ–ª–æ</button>
    <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
</div>

<div class="container submenu hidden" id="asalMenu">
    <audio id="asalAudio" autoplay class="hidden"></audio>
    <div id="asalScreen">üíñ –ú—ã –ª—é–±–∏–º –ê—Å–∞–ª—å üíñ</div>
    <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
</div>

<div class="container submenu hidden" id="gdzMenu">
    <iframe src="" id="gdzFrame" allowfullscreen></iframe>
    <button data-gdzkey="english">–ì–î–ó –ê–Ω–≥–ª–∏–π—Å–∫–∏–π</button>
    <button class="back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
</div>

<div class="container submenu hidden" id="studentsMenu">
    <div id="disclaimer">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</div>
    <input id="studentPassInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off" />
    <button id="studentPassBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>

<div class="container submenu hidden" id="studentsListMenu">
    <input id="studentTokenInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞" autocomplete="off" />
    <button id="studentTokenBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
    <button data-student="timur" data-encrypted="13245533499" data-name="–¢–∏–º—É—Ä">üîí 13245533499</button>
    <button data-student="ibrohim" data-encrypted="39284232" data-name="–ò–±—Ä–æ—Ö–∏–º">üîí 39284232</button>
    <button data-student="amar" data-encrypted="5432109876" data-name="–ê–º–∞—Ä">üîí 5432109876</button>
    <button data-student="sabrina" data-encrypted="22214344" data-name="–°–∞–±—Ä–∏–Ω–∞">üîí 22214344</button>
    <button data-student="said" data-encrypted="12312333" data-name="–°–∞–∏–¥">üîí 12312333</button>
    <button data-student="said_samandarov" data-encrypted="31254355" data-name="–°–∞–∏–¥">üîí 31254355</button>
    <button data-student="abdumumin" data-encrypted="98765432" data-name="–ê–±–¥—É–º—É–º–∏–Ω">üîí 7777789</button>
    <button data-student="abubaker" data-encrypted="45678912" data-name="–ê–±—É–±–∞–∫–µ—Ä">üîí 45678912</button>
    <button data-student="Mohir" data-encrypted="45678912" data-name="–ú–æ—Ö–∏—Ä">üîí 45678912</button>
    <button data-student="Salta" data-encrypted="98765678" data-name="–°–∞–ª—Ç–∞–Ω–∞—Ç">üîí 98765678</button>
    <button data-student="Zarina" data-encrypted="46543213" data-name="–ó–∞—Ä–∏–Ω–∞">üîí 46543213</button>
    <button data-student="Nasta" data-encrypted="98765432" data-name="–ù–∞—Å—Ç—è">üîí 98765432</button>
    <button class="back">–ù–∞–∑–∞–¥</button>
</div>

<div class="container submenu hidden" id="studentInfoMenu">
    <img id="studentPhoto" src="" alt="–§–æ—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç–∞" />
    <div id="studentInfo"></div>
    <button class="back">–ù–∞–∑–∞–¥</button>
</div>

<div id="gameContainer">
    <div id="minefield"></div>
    <button id="restartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    <div id="gameMessage" style="margin-top:10px; text-align:center;"></div>
</div>

<script type="module">
    import { get, ref, set, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const db = window.firebaseDatabaseInstance; // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è firebase –≥–¥–µ-—Ç–æ –µ—Å—Ç—å

    // –î–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–æ–≤ (–ø–æ–ª–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å —Ç–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
    const studentsData = {
        timur: {
            name: '–¢–∏–º—É—Ä',
            surname: '–ù—É—Ä–∞–ª–∏–µ–≤',
            patronymic: '–ú—É–∑–∞—Ñ—Ñ–∞—Ä–æ–≤–∏—á',
            birthDate: '28.08.2011',
            father: '–ú—É–∑–∑–∞—Ñ–∞—Ä –ù—É—Ä–∞–ª–∏–µ–≤',
            mother: '–ú–∞—Ñ—Ç—É–Ω–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, –ù—É—Ä–∞–ª–∏–µ–≤–∞)',
            class: '8–î Vosiq',
            phone: '+998946372464',
            motherPhone: '+998900060030',
            fatherPhone: '+998988122711',
            siblings: '–°–µ—Å—Ç—Ä–∞: –ê—Å–∞–ª—å –ù—É—Ä–∞–ª–∏–µ–≤–∞, 12 –ª–µ—Ç, 6–ö Vosiq',
            seria: 'FA9854006',
            photo: 'photo_2025-08-02_19-28-21.jpg'
        },
        ibrohim: {
            name: '–ò–±—Ä–æ—Ö–∏–º–∂–æ–Ω',
            surname: '–®–∞—Ä–∏–ø–æ–≤',
            patronymic: '–ë–∞–±—É—Ä –æ–≥–ª–∏',
            birthDate: '31.08.2011',
            father: '–ê—Ö–º–µ–¥–æ–≤ –ë–∞–±–∏—Ä –®–∞—Ä–∏–ø–æ–≤–∏—á',
            mother: '–ê—Ö–º–µ–¥–æ–≤–∞ –†—É—Ö—Å–æ—Ä–∞ –¢—É–π–º—É—Ä–æ–¥–æ–≤–∞',
            class: '8–î',
            phone: '+998917841115',
            motherPhone: '–ù–µ—Ç',
            fatherPhone: '–ù–µ—Ç',
            siblings: '–°–µ—Å—Ç—Ä–∞, –Ω–µ —Ä–æ–¥–Ω–∞—è',
            seria: '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
            photo: 'photo_2025-08-02_19-59-32.jpg'
        },
        amar: {
            name: '–ê–º–∞—Ä',
            surname: '–†—É—Å—Ç–∞–º–æ–≤',
            patronymic: '–ê–±–¥—É–ª–ª–∞–µ–≤–∏—á',
            birthDate: '22.02.2011',
            father: '–ê–±–¥—É–ª–ª–æ—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, –†—É—Å—Ç–∞–º–æ–≤)',
            mother: '–ë–∞—Ä–Ω–æ (—Ñ–∞–º–∏–ª–∏—è –∏ –æ—Ç—á–µ—Å—Ç–≤–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã)',
            class: '8–î Vosiq',
            phone: '+998901779599',
            motherPhone: '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
            fatherPhone: '+998919199999',
            siblings: '–ë—Ä–∞—Ç: –°—É–ª–µ–π–º–∞–Ω –†—É—Å—Ç–∞–º–æ–≤, –ê–±–¥—É–ª–ª–∞–µ–≤–∏—á, 22.09.2013, Vosiq, +998970063007; –ë—Ä–∞—Ç: –ú—É—Ö–∞–º–º–∞–¥ –†—É—Å—Ç–∞–º–æ–≤, –ê–±–¥—É–ª–ª–∞–µ–≤–∏—á, 8-10 –ª–µ—Ç, Vosiq, –Ω–æ–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç; –ë—Ä–∞—Ç: –ê–±—É–±–∞–∫—Ä –†—É—Å—Ç–∞–º–æ–≤, 3-5 –ª–µ—Ç, —Å–∞–¥–∏–∫ Vosiq, –Ω–æ–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
            photo: 'photo_2025-08-02_21-29-13.jpg'
        },
        // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å...
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let isTokenVerified = false;
    let balance = 0;

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const tokenInput = document.getElementById('tokenInput');
    const loginBtn = document.getElementById('loginBtn');
    const auth = document.querySelector('.auth');
    const menu = document.querySelector('.menu');
    const musicMenu = document.getElementById('musicMenu');
    const videoMenu = document.getElementById('videoMenu');
    const asalMenu = document.getElementById('asalMenu');
    const gdzMenu = document.getElementById('gdzMenu');
    const studentsMenu = document.getElementById('studentsMenu');
    const studentsListMenu = document.getElementById('studentsListMenu');
    const studentInfoMenu = document.getElementById('studentInfoMenu');
    const studentInfo = document.getElementById('studentInfo');
    const studentPhoto = document.getElementById('studentPhoto');
    const studentPassInput = document.getElementById('studentPassInput');
    const studentPassBtn = document.getElementById('studentPassBtn');
    const studentTokenInput = document.getElementById('studentTokenInput');
    const studentTokenBtn = document.getElementById('studentTokenBtn');
    const consoleBtn = document.getElementById('consoleBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const minesweeperBtn = document.getElementById('minesweeperBtn');
    const gameContainer = document.getElementById('gameContainer');
    const minefield = document.getElementById('minefield');
    const restartBtn = document.getElementById('restartBtn');
    const gameMessage = document.getElementById('gameMessage');

    // –ê—É–¥–∏–æ/–í–∏–¥–µ–æ
    const audio = document.getElementById('audio');
    const video = document.getElementById('video');
    const asalAudio = document.getElementById('asalAudio');

    // –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è
    function showElement(el) {
        if (!el) return;
        el.classList.remove('hidden');
        el.classList.add('visible');
        document.body.classList.add('transitioning');
        setTimeout(() => document.body.classList.remove('transitioning'), 1000);
    }
    function hideElement(el) {
        if (!el) return;
        el.classList.remove('visible');
        el.classList.add('hidden');
    }
    function hideElements(elements) {
        elements.forEach(el => hideElement(el));
    }

    // –ú–µ–Ω—é
    function openMenu(menuId) {
        hideElements([menu, auth, musicMenu, videoMenu, asalMenu, gdzMenu, studentsMenu, studentsListMenu, studentInfoMenu, gameContainer]);
        audio.pause(); audio.classList.add('hidden'); audio.src = '';
        video.pause(); video.classList.add('hidden'); video.src = '';
        asalAudio.pause(); asalAudio.classList.add('hidden'); asalAudio.src = '';
        studentInfo.textContent = '';
        studentPhoto.src = '';
        studentTokenInput.value = '';
        isTokenVerified = false;
        studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
            btn.textContent = `üîí ${btn.getAttribute('data-encrypted')}`;
            btn.classList.remove('unlocked');
        });
        if(menuId === 'asalMenu'){
            asalAudio.src = 'ppol.mp3';
            asalAudio.classList.remove('hidden');
            asalAudio.play().catch(() => alert('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ppol.mp3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞.'));
        }
        const el = document.getElementById(menuId);
        if(el) showElement(el);
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (firebase)
    async function checkToken(token) {
        try {
            const snapshot = await get(ref(db, 'tokens/' + token));
            return snapshot.exists();
        } catch (e) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞: ' + e.message);
            return false;
        }
    }
    async function checkStudentToken(token) {
        try {
            const snapshot = await get(ref(db, 'studentTokens/' + token));
            return snapshot.exists();
        } catch (e) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + e.message);
            return false;
        }
    }

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    loginBtn.addEventListener('click', async () => {
        const token = tokenInput.value.trim();
        if(!token) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
        loginBtn.disabled = true;
        const valid = await checkToken(token);
        loginBtn.disabled = false;
        if(valid) {
            hideElement(auth);
            showElement(menu);
        } else alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');
    });

    logoutBtn.addEventListener('click', () => {
        hideElement(menu);
        hideElements(document.querySelectorAll('.submenu'));
        tokenInput.value = '';
        showElement(auth);
    });

    // –ú–µ–Ω—é –∫–Ω–æ–ø–∫–∏
    menu.querySelectorAll('button[data-menu]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const menuId = btn.getAttribute('data-menu');
            hideElement(menu);
            openMenu(menuId);
        });
    });

    // –ù–∞–∑–∞–¥
    document.querySelectorAll('.back').forEach(btn => {
        btn.addEventListener('click', () => {
            if(studentInfoMenu.classList.contains('visible')) {
                hideElement(studentInfoMenu);
                showElement(studentsListMenu);
            } else if(studentsListMenu.classList.contains('visible')) {
                hideElement(studentsListMenu);
                showElement(studentsMenu);
            } else {
                hideElements(document.querySelectorAll('.submenu'));
                showElement(menu);
            }
        });
    });

    // –ê—É–¥–∏–æ
    musicMenu.querySelectorAll('button[data-audio]').forEach(btn => {
        btn.addEventListener('click', () => {
            const audioFile = btn.getAttribute('data-audio');
            video.pause(); video.classList.add('hidden');
            asalAudio.pause(); asalAudio.classList.add('hidden');
            audio.src = audioFile;
            audio.classList.remove('hidden');
            audio.play().catch(() => alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ${audioFile}.`));
        });
    });

    // –í–∏–¥–µ–æ
    videoMenu.querySelectorAll('button[data-video]').forEach(btn => {
        btn.addEventListener('click', () => {
            const videoFile = btn.getAttribute('data-video');
            audio.pause(); audio.classList.add('hidden');
            asalAudio.pause(); asalAudio.classList.add('hidden');
            video.src = videoFile;
            video.classList.remove('hidden');
            video.load();
            video.play().catch(() => alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ${videoFile}.`));
        });
    });

    // GDZ
    const gdzUrls = { 'english': 'https://gdz.ru/class-7/english/spotlight-7/' };
    gdzMenu.querySelectorAll('button[data-gdzkey]').forEach(btn => {
        btn.addEventListener('click', () => {
            const key = btn.getAttribute('data-gdzkey');
            if(gdzUrls[key]) gdzFrame.src = gdzUrls[key];
        });
    });

    // –ü–∞—Ä–æ–ª—å –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    studentPassBtn.addEventListener('click', () => {
        const pass = studentPassInput.value.trim();
        if(pass === 'V228') {
            hideElement(studentsMenu);
            showElement(studentsListMenu);
            studentPassInput.value = '';
        } else alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    });

    // –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    studentTokenBtn.addEventListener('click', async () => {
        const token = studentTokenInput.value.trim();
        if(!token) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
        const valid = await checkStudentToken(token);
        if(valid) {
            isTokenVerified = true;
            studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
                btn.textContent = btn.getAttribute('data-name');
                btn.classList.add('unlocked');
            });
            studentTokenInput.value = '';
        } else alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
    });

    // –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—á–µ–Ω–∏–∫–µ
    studentsListMenu.querySelectorAll('button[data-student]').forEach(btn => {
        btn.addEventListener('click', () => {
            if(!isTokenVerified) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
                return;
            }
            const key = btn.getAttribute('data-student');
            const student = studentsData[key];
            if(!student) {
                alert('–î–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            hideElement(studentsListMenu);
            showElement(studentInfoMenu);

            studentPhoto.src = student.photo || '';
            studentPhoto.alt = student.name + ' –§–æ—Ç–æ';

            studentInfo.innerHTML = '';
            Object.entries(student).forEach(([k,v], i) => {
                if(k === 'photo') return;
                const span = document.createElement('span');
                span.style.setProperty('--i', i);
                span.textContent = `${k[0].toUpperCase() + k.slice(1)}: ${v}`;
                studentInfo.appendChild(span);
            });
        });
    });

    // –ö–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –º–æ–Ω–µ—Ç–∞–º–∏
    consoleBtn.addEventListener('click', async () => {
        const consoleToken = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏');
        if (consoleToken !== 'V') {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            return;
        }

        const panel = document.createElement('div');
        panel.style = `
            position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
            background: #001d3d; color: white; padding: 20px; border-radius: 10px;
            z-index: 100000; max-width: 420px; width: 90vw;
            max-height: 70vh; overflow-y: auto;
            font-size: clamp(0.9em, 2.5vw, 1em);
        `;

        panel.innerHTML = `
            <h2>–ö–æ–Ω—Å–æ–ª—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –º–æ–Ω–µ—Ç–∞–º–∏</h2>
            <input id="newTokenInput" placeholder="–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω" style="width: 80%; padding: 8px; margin-bottom: 10px; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
            <button id="addTokenBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            <input id="newStudentTokenInput" placeholder="–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞" style="width: 80%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
            <button id="addStudentTokenBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞</button>
            <br/>
            <input id="coinsAmountInput" type="number" min="1" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç" style="width: 80%; padding: 8px; border-radius: 6px; border: 1px solid var(--blue); background: transparent; color: white;" />
            <button id="giveCoinsBtn">–í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç—ã</button>
            <br/>
            <div id="tokensList" style="margin-top: 15px; max-height: 150px; overflow-y: auto; border: 1px solid #444; padding: 8px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤...</div>
            <div id="studentTokensList" style="margin-top: 15px; max-height: 150px; overflow-y: auto; border: 1px solid #444; padding: 8px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞...</div>
            <button id="closeConsoleBtn" style="margin-top: 15px; background: var(--blue-dark); padding: 8px 16px; border-radius: 6px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;

        document.body.appendChild(panel);

        const newTokenInput = panel.querySelector('#newTokenInput');
        const addTokenBtn = panel.querySelector('#addTokenBtn');
        const newStudentTokenInput = panel.querySelector('#newStudentTokenInput');
        const addStudentTokenBtn = panel.querySelector('#addStudentTokenBtn');
        const closeConsoleBtn = panel.querySelector('#closeConsoleBtn');
        const tokensList = panel.querySelector('#tokensList');
        const studentTokensList = panel.querySelector('#studentTokensList');
        const coinsAmountInput = panel.querySelector('#coinsAmountInput');
        const giveCoinsBtn = panel.querySelector('#giveCoinsBtn');

        async function updateTokensList() {
            try {
                tokensList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤...';
                const snapshot = await get(ref(db, 'tokens'));
                if (snapshot.exists()) {
                    const tokens = snapshot.val();
                    tokensList.innerHTML = '';
                    if (Object.keys(tokens).length === 0) {
                        tokensList.textContent = '–¢–æ–∫–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                    } else {
                        Object.keys(tokens).forEach(t => {
                            const tokenEl = document.createElement('div');
                            tokenEl.style = 'display:flex; justify-content:space-between; margin-bottom:6px; border-bottom: 1px solid #444; padding-bottom:4px;';
                            tokenEl.textContent = t;
                            const delBtn = document.createElement('button');
                            delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                            delBtn.style.background = '#a00';
                            delBtn.style.color = 'white';
                            delBtn.style.border = 'none';
                            delBtn.style.borderRadius = '6px';
                            delBtn.style.cursor = 'pointer';
                            delBtn.addEventListener('click', async () => {
                                try {
                                    await remove(ref(db, 'tokens/' + t));
                                    updateTokensList();
                                } catch (error) {
                                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ' + error.message);
                                }
                            });
                            tokenEl.appendChild(delBtn);
                            tokensList.appendChild(tokenEl);
                        });
                    }
                } else {
                    tokensList.textContent = '–¢–æ–∫–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                }
            } catch (error) {
                tokensList.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤: ' + error.message;
            }
        }

        async function updateStudentTokensList() {
            try {
                studentTokensList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞...';
                const snapshot = await get(ref(db, 'studentTokens'));
                if (snapshot.exists()) {
                    const tokens = snapshot.val();
                    studentTokensList.innerHTML = '';
                    if (Object.keys(tokens).length === 0) {
                        studentTokensList.textContent = '–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                    } else {
                        Object.keys(tokens).forEach(t => {
                            const tokenEl = document.createElement('div');
                            tokenEl.style = 'display:flex; justify-content:space-between; margin-bottom:6px; border-bottom: 1px solid #444; padding-bottom:4px;';
                            tokenEl.textContent = t;
                            const delBtn = document.createElement('button');
                            delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                            delBtn.style.background = '#a00';
                            delBtn.style.color = 'white';
                            delBtn.style.border = 'none';
                            delBtn.style.borderRadius = '6px';
                            delBtn.style.cursor = 'pointer';
                            delBtn.addEventListener('click', async () => {
                                try {
                                    await remove(ref(db, 'studentTokens/' + t));
                                    updateStudentTokensList();
                                } catch (error) {
                                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + error.message);
                                }
                            });
                            tokenEl.appendChild(delBtn);
                            studentTokensList.appendChild(tokenEl);
                        });
                    }
                } else {
                    studentTokensList.textContent = '–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
                }
            } catch (error) {
                studentTokensList.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞: ' + error.message;
            }
        }

        addTokenBtn.addEventListener('click', async () => {
            const newToken = newTokenInput.value.trim();
            if (!newToken) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
            try {
                await set(ref(db, 'tokens/' + newToken), true);
                newTokenInput.value = '';
                updateTokensList();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ' + error.message);
            }
        });

        addStudentTokenBtn.addEventListener('click', async () => {
            const newStudentToken = newStudentTokenInput.value.trim();
            if (!newStudentToken) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
            try {
                await set(ref(db, 'studentTokens/' + newStudentToken), true);
                newStudentTokenInput.value = '';
                updateStudentTokensList();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞: ' + error.message);
            }
        });

        giveCoinsBtn.addEventListener('click', () => {
            const amount = parseInt(coinsAmountInput.value, 10);
            if (isNaN(amount) || amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç');
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥ –º–æ–Ω–µ—Ç (–ø—Ä–∏–º–µ—Ä: COIN- + —Ä–∞–Ω–¥–æ–º)
            const coinCode = 'COIN-' + Math.random().toString(36).substring(2, 10).toUpperCase();
            // –í—ã–¥–∞—á–∞: –ø—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (–∏–ª–∏ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ –±–∞–∑—É)
            balance += amount;
            updateBalanceDisplay();
            alert(`–í—ã–¥–∞–Ω–æ ${amount} –º–æ–Ω–µ—Ç. –ö–æ–¥: ${coinCode}`);
            coinsAmountInput.value = '';
        });

        closeConsoleBtn.addEventListener('click', () => {
            panel.remove();
        });

        updateTokensList();
        updateStudentTokensList();
    });

    // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function updateBalanceDisplay() {
        balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balance} –º–æ–Ω–µ—Ç`;
    }
    updateBalanceDisplay();

    // –°–∞–ø–µ—Ä
    minesweeperBtn.addEventListener('click', () => {
        hideElements([menu, musicMenu, videoMenu, asalMenu, gdzMenu, studentsMenu, studentsListMenu, studentInfoMenu]);
        gameContainer.style.display = 'block';
        initMinesweeper();
    });

    restartBtn.addEventListener('click', () => {
        initMinesweeper();
    });

    // –õ–æ–≥–∏–∫–∞ —Å–∞–ø–µ—Ä–∞ 9x9, 10 –º–∏–Ω
    const ROWS = 9;
    const COLS = 9;
    const MINES = 10;
    let board = [];
    let revealedCount = 0;
    let gameOver = false;

    function initMinesweeper() {
        board = [];
        revealedCount = 0;
        gameOver = false;
        gameMessage.textContent = '';
        minefield.innerHTML = '';

        // –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
        for(let r = 0; r < ROWS; r++) {
            board[r] = [];
            for(let c = 0; c < COLS; c++) {
                board[r][c] = {mine:false, revealed:false, flagged:false, adjacent:0};
            }
        }

        // –†–∞—Å—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω—ã —Å–ª—É—á–∞–π–Ω–æ
        let placedMines = 0;
        while(placedMines < MINES) {
            let r = Math.floor(Math.random() * ROWS);
            let c = Math.floor(Math.random() * COLS);
            if(!board[r][c].mine) {
                board[r][c].mine = true;
                placedMines++;
            }
        }

        // –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –º–∏–Ω—ã
        for(let r = 0; r < ROWS; r++) {
            for(let c = 0; c < COLS; c++) {
                if(board[r][c].mine) continue;
                let count = 0;
                for(let dr=-1; dr<=1; dr++) {
                    for(let dc=-1; dc<=1; dc++) {
                        if(dr===0 && dc===0) continue;
                        let nr = r + dr;
                        let nc = c + dc;
                        if(nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                            if(board[nr][nc].mine) count++;
                        }
                    }
                }
                board[r][c].adjacent = count;
            }
        }

        // –°–æ–∑–¥–∞—Ç—å DOM –∫–ª–µ—Ç–∫–∏
        for(let r=0; r < ROWS; r++) {
            for(let c=0; c < COLS; c++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.r = r;
                cell.dataset.c = c;
                cell.textContent = '';
                cell.addEventListener('click', onCellClick);
                minefield.appendChild(cell);
            }
        }
    }

    function onCellClick(e) {
        if(gameOver) return;
        const cell = e.currentTarget;
        const r = parseInt(cell.dataset.r, 10);
        const c = parseInt(cell.dataset.c, 10);
        const cellData = board[r][c];
        if(cellData.revealed) return;

        revealCell(r, c);
        updateMinefield();

        if(cellData.mine) {
            gameOver = true;
            gameMessage.textContent = '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!';
            revealAllMines();
        } else if(revealedCount === ROWS*COLS - MINES) {
            gameOver = true;
            gameMessage.textContent = '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!';
            balance += 5; // –Ω–∞–ø—Ä–∏–º–µ—Ä, +5 –º–æ–Ω–µ—Ç –∑–∞ –ø–æ–±–µ–¥—É
            updateBalanceDisplay();
        }
    }

    function revealCell(r, c) {
        const cell = board[r][c];
        if(cell.revealed) return;
        cell.revealed = true;
        revealedCount++;
        if(cell.adjacent === 0 && !cell.mine) {
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
            for(let dr=-1; dr<=1; dr++) {
                for(let dc=-1; dc<=1; dc++) {
                    if(dr===0 && dc===0) continue;
                    const nr = r+dr;
                    const nc = c+dc;
                    if(nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                        if(!board[nr][nc].mine && !board[nr][nc].revealed) {
                            revealCell(nr, nc);
                        }
                    }
                }
            }
        }
    }

    function updateMinefield() {
        const cells = minefield.children;
        for(let i=0; i<cells.length; i++) {
            const cell = cells[i];
            const r = parseInt(cell.dataset.r, 10);
            const c = parseInt(cell.dataset.c, 10);
            const data = board[r][c];
            cell.classList.toggle('revealed', data.revealed);
            if(data.revealed) {
                if(data.mine) {
                    cell.classList.add('mine');
                    cell.textContent = 'üí£';
                } else if(data.adjacent > 0) {
                    cell.textContent = data.adjacent;
                } else {
                    cell.textContent = '';
                }
            } else {
                cell.classList.remove('mine');
                cell.textContent = '';
            }
        }
    }

    function revealAllMines() {
        for(let r=0; r < ROWS; r++) {
            for(let c=0; c < COLS; c++) {
                if(board[r][c].mine) board[r][c].revealed = true;
            }
        }
        updateMinefield();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è intro –∏ –ø–æ–∫–∞–∑ auth
    window.addEventListener('load', () => {
        setTimeout(() => {
            const intro = document.getElementById('intro');
            intro.style.display = 'none';
            showElement(auth);
        }, 4000);
    });
</script>
</body>
</html>
